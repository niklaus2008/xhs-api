version: '3.8'

services:
  # æœåŠ¡ 1: å°çº¢ä¹¦çˆ¬è™«
  xhs-service:
    build: .
    container_name: xhs-scraper
    ports:
      - "8000:8000"
    environment:
      # æŒä¹…åŒ– Chromium ç”¨æˆ·æ•°æ®ç›®å½•ï¼ˆç”¨äºå¤ç”¨ç™»å½•æ€ï¼‰
      - XHS_USER_DATA_PATH=/data/chrome
    volumes:
      # ğŸ‘‡ å…³é”®ï¼šæŠŠå®¿ä¸»æœºçš„ chrome-data æ˜ å°„è¿›å»ï¼Œè®©å®¹å™¨â€œç»§æ‰¿â€ä½ çš„ç™»å½•çŠ¶æ€
      # æ³¨æ„ï¼šè¿™é‡Œè¦ä¸ XHS_USER_DATA_PATH ä¿æŒä¸€è‡´ï¼ˆmain.py ä¾èµ–å®ƒæ¥å¯ç”¨æŒä¹…åŒ– Profileï¼‰
      - ./chrome-data:/data/chrome 
    restart: always

  # æœåŠ¡ 2: n8n (æ ¹æ®ä½ çš„ docker run å‘½ä»¤å®šåˆ¶)
  n8n:
    image: n8nio/n8n:2.0.1
    container_name: n8n-server  # å¯¹åº” --name n8n-server
    ports:
      - "5678:5678"             # å¯¹åº” -p 5678:5678
    environment:
      - GENERIC_TIMEZONE=Asia/Shanghai
      - N8N_SECURE_COOKIE=false
    volumes:
      - n8n_data:/home/node/.n8n                 # å¯¹åº” -v n8n_data:/home/node/.n8n
      # ğŸ‘‡ è¿™é‡Œè¡¥å……çš„æœ¬åœ°è·¯å¾„æ˜ å°„
      - /Users/liuqiang/code/data:/data_n8n      # å¯¹åº” -v /Users/liuqiang/code/data:/data_n8n
    restart: unless-stopped     # å¯¹åº” --restart unless-stopped
    depends_on:
      - xhs-service             # ç¡®ä¿çˆ¬è™«å…ˆå¯åŠ¨

# å®šä¹‰æ•°æ®å·
volumes:
  n8n_data:
    external: true